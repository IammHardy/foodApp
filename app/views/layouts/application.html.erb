<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Food App" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", type: "module" %>



    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="apple-touch-icon" href="/icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  </head>

  <body class="bg-gray-50 text-gray-800 font-sans">
  <!-- HEADER -->
<header class="bg-red-600 text-white shadow sticky top-0 z-50">
  <div class="max-w-6xl mx-auto flex items-center justify-between px-4 h-20 relative">
    
    <!-- Logo -->
    <%= link_to root_path, class: "text-3xl font-extrabold tracking-wide text-white" do %>
      Sajuma
    <% end %>

    <!-- Desktop Menu -->
    <nav class="hidden lg:flex gap-6 items-center">
      <%= link_to "Home", (current_user&.admin? ? admin_dashboard_path : root_path),
          class: "hover:text-yellow-400 font-medium" %>
      <%= link_to "Browse Menu", foods_path, class: "hover:text-yellow-400 font-bold" %>

      <% if user_signed_in? %>
        <% unless current_user.admin? %>
          <%= link_to "My Orders", orders_path, class: "hover:text-yellow-400 font-medium" %>
        <% end %>
        <%= button_to "Logout", destroy_user_session_path, method: :delete,
              form_class: "inline",
              class: "hover:text-yellow-400 font-medium" %>
      <% else %>
        <%= link_to "Login", new_user_session_path, class: "hover:text-yellow-400 font-medium" %>
        <%= link_to "Sign Up", new_user_registration_path, class: "hover:text-yellow-400 font-medium" %>
      <% end %>

      <% if current_cart.present? && current_cart.cart_items.any? %>
        <%= link_to cart_path, class: "relative hover:text-yellow-300" do %>
          <i class="fas fa-shopping-cart text-lg"></i>
          <span class="absolute -top-2 -right-3 bg-white text-red-600 text-xs font-bold rounded-full px-2 py-0.5">
            <%= current_cart.cart_items.sum(:quantity) %>
          </span>
        <% end %>
      <% end %>
    </nav>

    <!-- Hamburger (mobile only) -->
    <button id="hamburger-btn" class="lg:hidden text-white text-2xl relative z-50">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Mobile Menu -->
   <nav id="mobile-nav" class="hidden absolute top-full right-0 left-0 bg-white shadow-lg z-60 flex flex-col gap-1 p-4 rounded-b-md transition-all duration-300 transform -translate-y-5 opacity-0">
      <%= link_to "Home", (current_user&.admin? ? admin_dashboard_path : root_path),
          class: "block px-4 py-2 text-red-600 hover:bg-red-100 hover:text-yellow-400 font-medium rounded" %>

      <% if user_signed_in? %>
        <span class="block px-4 py-2 text-gray-500 text-sm">
          Logged in as <%= current_user.email %>
        </span>

        <% unless current_user.admin? %>
          <%= link_to "My Orders", orders_path,
              class: "block px-4 py-2 text-red-600 hover:bg-red-100 hover:text-yellow-400 font-medium rounded" %>
        <% end %>

        <%= button_to "Logout", destroy_user_session_path, method: :delete,
              form_class: "inline",
              class: "block px-4 py-2 text-red-600 hover:bg-red-100 hover:text-yellow-400 font-medium rounded" %>
      <% else %>
        <%= link_to "Login", new_user_session_path,
              class: "block px-4 py-2 text-red-600 hover:bg-red-100 hover:text-yellow-400 font-medium rounded" %>
        <%= link_to "Sign Up", new_user_registration_path,
              class: "block px-4 py-2 text-red-600 hover:bg-red-100 hover:text-yellow-400 font-medium rounded" %>
      <% end %>

      <%= link_to "Browse Menu", foods_path,
            class: "block px-4 py-2 text-red-600 hover:bg-red-100 hover:text-yellow-400 font-bold rounded" %>

      <% if current_cart.present? && current_cart.cart_items.any? %>
        <%= link_to cart_path, class: "relative block px-4 py-2 text-yellow-400 hover:text-yellow-300" do %>
          <i class="fas fa-shopping-cart text-lg"></i>
          <span class="absolute -top-2 -right-3 bg-white text-red-600 text-xs font-bold rounded-full px-2 py-0.5">
            <%= current_cart.cart_items.sum(:quantity) %>
          </span>
        <% end %>
      <% end %>
    </nav>

  </div>
</header>

<script>
  const btn = document.getElementById('hamburger-btn');
  const nav = document.getElementById('mobile-nav');

  btn.addEventListener('click', (e) => {
    e.stopPropagation(); // prevent document click
    const icon = btn.querySelector('i');
    nav.classList.toggle('hidden');
    if (!nav.classList.contains('hidden')) {
      nav.classList.remove('-translate-y-5', 'opacity-0');
      nav.classList.add('translate-y-0', 'opacity-100');
      icon.classList.remove('fa-bars');
      icon.classList.add('fa-times');
    } else {
      nav.classList.add('-translate-y-5', 'opacity-0');
      nav.classList.remove('translate-y-0', 'opacity-100');
      icon.classList.remove('fa-times');
      icon.classList.add('fa-bars');
    }
  });

  document.addEventListener('click', (e) => {
    if (!btn.contains(e.target) && !nav.contains(e.target)) {
      if (!nav.classList.contains('hidden')) {
        nav.classList.add('-translate-y-5', 'opacity-0');
        nav.classList.remove('translate-y-0', 'opacity-100');
        setTimeout(() => nav.classList.add('hidden'), 300);
        btn.querySelector('i').classList.remove('fa-times');
        btn.querySelector('i').classList.add('fa-bars');
      }
    }
  });
</script>


    <!-- FLASH -->
    <div id="flash-container" class="fixed top-16 left-1/2 -translate-x-1/2 z-50 space-y-2">
      <% flash.each do |type, message| %>
        <% css_class = case type.to_sym
                      when :notice then "bg-green-500"
                      when :alert then "bg-red-500"
                      else "bg-blue-500"
                      end %>
        <div class="p-4 rounded-md text-center font-bold text-white shadow-lg animate-fade-in-out">
          <%= message %>
        </div>
      <% end %>
    </div>

    <!-- MAIN CONTENT -->
    <%= yield %>

    <!-- FLASH SCRIPT -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const flashContainer = document.getElementById("flash-container");
        if (flashContainer) {
          setTimeout(() => {
            flashContainer.style.transition = "opacity 0.5s";
            flashContainer.style.opacity = "0";
            setTimeout(() => flashContainer.remove(), 500);
          }, 4000);
        }
      });
    </script>

    <style>
      @keyframes fade-in-out {
        0% { opacity: 0; transform: translateY(-10px); }
        10% { opacity: 1; transform: translateY(0); }
        90% { opacity: 1; transform: translateY(0); }
        100% { opacity: 0; transform: translateY(-10px); }
      }
      .animate-fade-in-out {
        animation: fade-in-out 4s ease forwards;
      }
    </style>
   
  </body>
</html>